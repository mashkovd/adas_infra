#cloud-config
package_update: true
package_upgrade: true
packages:
  - curl
  - gitlab-runner

runcmd:
  - curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
  - chmod +x /usr/local/bin/gitlab-runner
  - useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash
  - gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
  - gitlab-runner start
  - gitlab-runner register --non-interactive --url ${gitlab_url} --registration-token ${gitlab_runner_registration_token} --executor shell --description "My Runner" --tag-list "shell" --run-untagged --locked=false
